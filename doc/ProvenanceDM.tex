\documentclass[11pt,a4paper]{ivoa}
\input tthdefs

\usepackage[utf8]{inputenc}
\usepackage{booktabs, tabulary}    % for nicer tables
\usepackage[titletoc,toc,title]{appendix}

% make the text in pdf properly searchable
\usepackage{lmodern}

% use listings for including text files and code snippets
\usepackage{listings}
\usepackage{color}
\usepackage[nottoc]{tocbibind}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}


\ivoagroup{DM}

\author{Kristin Riebe}
\author{Mathieu Servillat}
\author{François Bonnarel}
\author{Mireille Louys}
\author{Florian Rothmaier}
\author{Michèle Sanguillon}
\author{IVOA Data Model Working Group}

\editor{Kristin Riebe}
\editor{Mathieu Servillat}

% \previousversion[????URL????]{????Funny Label????}
\previousversion[http://www.ivoa.net/documents/ProvenanceDM/20161121/]{WD-ProvenanceDM-1.0-20161121.pdf}
\previousversion[http://volute.g-vo.org/svn/trunk/projects/dm/provenance/description/ProvDM-0.2-20160428.pdf]{ProvDM-0.2-20160428.pdf}
\previousversion[http://volute.g-vo.org/svn/trunk/projects/dm/provenance/description/ProvDM-0.1-20141008.pdf]{ProvDM-0.1-20141008.pdf}


% own definitions
\definecolor{todocolor}{rgb}{1,1,0.8}
\definecolor{darkred}{rgb}{0.6,0,0}
\definecolor{rose}{rgb}{1.0,0.88,0.88}
\definecolor{darkgrey}{rgb}{0.35,0.35,0.35}
%\newcommand{\TODO}[1]{%
%    \noindent%
%    \textcolor{todocolor}{\sffamily [\textbf{TODO:} #1]}%
%}

\newcommand{\TODO}[1]{%
    \noindent%
    \colorbox{todocolor}{%
            \parbox{0.85\linewidth}{\sffamily \textbf{TODO:}\\
            #1}
    }%
    \vspace{2pt}

}

\newcommand{\note}[1]{%
    \noindent%
    \textcolor{darkgrey}{{\sffamily Note:} \emph{#1}}%
}

\newcommand{\comment}[1]{%
    \noindent%
    \textcolor{red}{{\sffamily Comment:} \emph{#1}}%
}


\newcommand{\paragraphlb}[1]{\paragraph{#1}\mbox{}\\} % paragraph with line break

\setlength{\fboxsep}{5pt}
%\setlength{\fboxrule}{1.5pt}
\newcommand{\warning}[1]{%
    \vspace{\baselineskip}
    \noindent
    \parbox{\linewidth}{%
        \colorbox{darkred}{%
            \parbox{0.7\linewidth}{\large \sffamily \textcolor{white}{Warning}}%
        }\\[-1pt]
        \noindent%
        \fcolorbox{darkred}{rose}{%
            \parbox{0.7\linewidth-2\fboxrule}{#1}%
        }%
    }%
    \vspace{\baselineskip}
}%

% for nicer tables:
\renewcommand{\arraystretch}{1.3}
\newcommand{\head}[1]{\textbf{#1}}


% smaller font in verbatim:
\usepackage{verbatimbox}


% define new command for classes and other stuff, in case we decide later on for a different style
\newcommand{\class}[1]{\emph{#1}}
\newcommand{\attribute}[1]{\texttt{#1}}
\newcommand{\attr}[1]{\texttt{#1}} % equivalent to \attribute

\newcommand{\urlparam}[1]{{\scriptsize{#1}}}
\newcommand{\urlvalue}[1]{{\scriptsize{#1}}}

\begin{document}
\newcolumntype{Y}{>{\raggedright\arraybackslash}X}

% define listing parameters 
\lstdefinestyle{customc}{
  belowcaptionskip=1\baselineskip,
  breaklines=true,
  frame=L,
  %xleftmargin=\parindent,
  language=XML,
  showstringspaces=false,
  basicstyle=\footnotesize,
  keywordstyle=\bfseries\color{green!40!black},
  %morekeywords={entity,activity, agent, used, wasGeneratedBy,prefix,  ...},
  morekeywords={agent, used, wasGeneratedBy,prefix,  ...},
  commentstyle=\color{purple!40!black},
  identifierstyle=\color{blue},
  %stringstyle=\color{orange},
  stringstyle=\color{mymauve},
  rulecolor=\color{black}
}
\lstset{escapechar=@,style=customc}


\title{IVOA Provenance Data Model}

\begin{abstract}
This document describes how provenance information for astronomical datasets 
%(with the focus on observational data) 
can be modeled, stored and exchanged within 
the astronomical community in a standardized way.
We follow the definition of provenance as proposed by the W3C\footnote{\url{https://www.w3.org/TR/prov-overview/}}, i.e. that provenance is information about entities, activities, and people involved in producing a piece of data or thing, which can be used to form assessments about its quality, reliability or trustworthiness.
Such provenance information in astronomy is important to enable any scientist to trace back
the origin of a dataset (e.g. an image, spectrum, catalog or single points in a 
spectral energy distribution diagram or a light curve), learn about the people and 
organizations involved in a project and assess the quality of the dataset as well
as the usefulness of the dataset for her own scientific work.
\end{abstract}


\section*{Acknowledgments}

This document has been developed in part with support from the German
Astrophysical Virtual Observatory, funded by BMBF Bewilligungsnummer 05A14BAD and 05A08VHA.
The Provenance Working Group acknowledges support from the Astronomy ESFRI and Research Infrastructure Cluster – ASTERICS project, funded by the European Commission under the Horizon 2020 Programme (GA 653477).

Thanks for fruitful discussions to: Catherine Boisson and Karl Kosak for the
binding to the Cerenkov Telescope Array (CTA) project, Gerard
Lemson and Laurent Michel for the VODML expression of the data model, Markus Demleitner,
Markus Nullmeier, Harry Enke, Jochen Klar, Ole Streicher, Anastasia Galkin and Adrian Partl
for fruitful discussions, remarks and comments during the different stages of this
specification.

\section*{Conformance-related definitions}

The words ``MUST'', ``SHALL'', ``SHOULD'', ``MAY'', ``RECOMMENDED'', and
``OPTIONAL'' (in upper or lower case) used in this document are to be
interpreted as described in IETF standard, \citet{std:RFC2119}.

The \emph{Virtual Observatory (VO)} is
a general term for a collection of federated resources that can be used
to conduct astronomical research, education, and outreach.
The \href{http://www.ivoa.net}{International
Virtual Observatory Alliance (IVOA)} is a global
collaboration of separately funded projects to develop standards and
infrastructure that enable VO applications.


\section{Introduction}
\input{intro-general}
\input{intro-requirements}
\input{intro-VOarchitecture}
\input{intro-previousefforts}


\section{The provenance data model}
\label{sec:datamodel}
\input{datamodel-description}


% make sure that images/tables of the previous section are printed
% before starting the new section -- comment out, if not needed
% \clearpage
%\section{Applying provenance -- Interactions with other Data models}\label{sec:dmlinks}
\section{Links to other data models}
\label{sec:dmlinks}
\input{datamodel-links}


% make sure that images/tables of the previous section are printed
% before starting the new section
\clearpage
\section{Serialization of the provenance data model}
\label{sec:serialisations}
\input{serializations}
%\subsection{Serializing of the data model core}
%\label{sec:intro-serialization}
%\input{serialisation-intro}
\section{Accessing provenance information}
\label{sec:provaccess}
\input{provaccess}


\section{Use cases -- applying the data model}
%Implementations of the data model for specific use cases}
\label{sec:usecases-implementations}
\input{usecases-implementations}

\begin{appendices}
%\appendix

\section{Serialization Examples}
\label{sec:appendix-serialization-examples}
\input{AppendixA-ML}


\section{PROV-VOTable serialisation and ProvTAP TAP schema}
\label{sec:appendix-prov-votable}
\input{PROV-VOTABLE}

\section{Changes from Previous Versions}
% No previous versions yet.
% these would be subsections "Changes from v. WD-..."
% Use itemize environments.
\subsection{Changes from WD-ProvenanceDM-1.0-20161121}
\begin{itemize}
%\item New appendix sections for ProvTAP added
\item Corrected and extended attribute tables and mapping tables for links with DatasetDM and SimDM.
\item Restructured Accessing provenance section by splitting it in two: Section~\ref{sec:serialisations} for explaining the different serialization formats and differences to W3C serializations, Section~\ref{sec:provaccess} for describing the access protocols ProvDAL and ProvTAP.
\item Removed discussion section, since now all the topics are addressed in the main text.
\item Added paragraph on how to use the model in Section~\ref{sec:usecases-implementations}.
\item Shortened serialization examples, partially moved them to appendix.
\item Added paragraph on VOSI interface.
\item Added a proposed serialization of description classes.
\item Modified text on the content of EntityDescription, now seen as Entity attributes known before the Entity instance exists.
\item Renamed Section~\ref{sec:usecases-implementations} to stress that it explains applications of the model (use cases); implementation details and code examples can be found in Implementation Note \citep{std:ProvenanceImplementationNote}.
\item Complete rewrite of the ProvDAL section in Section~\ref{sec:access_protocols}; new parameters, new figure and examples added.
\item Added additional figure for entity-activity relations.
\item Moved the figure showing relations between Provenance.Agent and Dataset.Party into Section~\ref{sec:dmlinks}.
\item Extended the entity role examples in table \ref{tab:entity-roles}.
\item Added links to provn and votable-serialization for HiPS-use case, added first part of provn as example in the HiPS-use case section.
\item More explanations on links to data models in Section~\ref{sec:dmlinks}, introduced subsections, added table with SimDM-mapping.
\item Moved detailed implementation section from appendix to a separate document (implementation note), shortened the use cases \& implementation section.
\item Attribute/class updates:
\begin{itemize}
    \item Added optional attributes \emph{Entity.creationTime} and \emph{EntityDescription.category}
    \item Added optional attributes \emph{Parameter.min},  \emph{Parameter.max},  \emph{Parameter.option}
    \item Removed the obscore/dataset attributes from EntityDescription, since they are specific for observations only and are not applicable to configuration entities etc.
    \item Use voprov:type and voprov:role in Table~\ref{tab:agent-roles} with example agent roles, i.e. replaced prov:person by Individual and prov:organization by Organization.
    \item Renamed \emph{label} attribute to \emph{name} everywhere, for more consistency with SimDM naming scheme (\emph{label} is reserved there for SKOS labels).
    \item Renamed attribute \emph{Entity.access} to \emph{Entity.rights} for more consistency with DatasetDM etc.
    \item Avoid double-meaning of \emph{description} (as reference and free-text description) by renaming the free-text description to \emph{annotation}. No need for an additional description-attribute for reference to the corresponding description class, since it's expressed by the corresponding link in the model anyway.
    \item Applied similar naming scheme to \emph{Parameter} and \emph{ParameterDescription}-classes
    \item Renamed \emph{docuLink} to \emph{doculink}
    \item Corrected attribute names in Table~\ref{tab:datasetmapping}.
\end{itemize}


\end{itemize}

\end{appendices}

\listoffigures
 
\listoftables

\bibliography{ivoatex/ivoabib,prov-refs}


\end{document}
