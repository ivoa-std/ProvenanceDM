\subsection{Provenance Data Model serialization}
There are two possible families of ProvenanceDM metadata serializations, examples for these can be found in the implementation section (\ref{sec:usecases-implementations}) and the links therein.
\begin{itemize}
 \item W3C serializations: PROV\-N, PROV\-JSON, PROV\-XML. These are serializations of the W3C provenance data model. They allow the possibility to add additional IVOA or ad hoc attributes to the basic ones in each class. This way the IVOA models can produce W3C compliant serializations.
% \item Mapping of ProvenanceDM classes onto tables with appropriate relationships. This can allow management by a TAP service (the model mapping is then described with the TAP schema). The serialization will result in a single table according to the query.

 %\TODO{TAP SCHEMA of the ProvenanceDM datamodel: Maybe Mathieu can provide us with a copy of the TAP schema he designed ?}

 \item Direct VOTABLE mapping by using some ad hoc mapping based on transcription of PROV-N format: this is called PROV-VOTABLE. Moreover in the future we could also define a VO-DML \citep{std:VODML} version of the mapping.
The following is an example of provenance metadata in this PROV-VOTABLE format. Objects become tables, their classes are rendered by a utype. Attributes and relationships become FIELDS or PARAMS. The model attribute names also become VOTABLE utypes.  
\begin{verbatim}

<?xml version="1.0" encoding="UTF-8"?>
<VOTABLE version="1.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.ivoa.net/xml/VOTable/v1.2"
  xsi:schemaLocation="http://www.ivoa.net/xml/VOTable/v1.2 http://www.ivoa.net/xml/VOTable/v1.2">


<RESOURCE name="RGB">

<TABLE name="activities" utype="prov:Activity" >

     
     <FIELD name="ident" ucd="meta.id" utype ="prov:Activity.id" datatype="char" arraysize="*"/>
     <FIELD name="label"  ucd="meta.title" utype="prov:Activity.label"  datatype="char" arraysize="*"/>
     <FIELD name="start"  ucd="time.start" utype="prov:Activity.startTime" datatype="char" arraysize="*" xtype="ISO8601" />
     <FIELD name ="stop" ucd="time.end" utype="prov:Activity.endTime"  datatype="char" arraysize="*" xtype="ISO8601"  />
     <FIELD name="annotation" ucd="meta.description" utype="voprov:Activity.annotation" datatype="char" arraysize="*"  />
     <FIELD name="description" utype="voprov:Activity.ActivityDescRef" datatype="char" arraysize="*"  />  

<DATA>
<TABLEDATA>
<TR><TD>AlaRGB1</TD><TD>Aladin RGB 1</TD><TD>2017-04-18T17:28:00</TD><TD>2017-04-19T17:29:00</TD><TD>Aladin RGB image generation for NGC 6946Â </TD><TD>AlaRGB</TD></TR>
</TABLEDATA>
</DATA>      
</TABLE>

<TABLE name="activity descriptions" utype="prov:ActivityDesc" >

     
     <FIELD name="ident" ucd="meta.id" utype="prov:ActivityDesc.id" datatype="char" arraysize="*"/>
     <FIELD name="label" ucd="meta.title" utype="prov:ActivityDesc.label" datatype="char" arraysize="*"/>
     <FIELD name="type" ucd="meta.code.class" utype="prov:ActivityDesc.type" datatype="char" arraysize="*" />
     <FIELD name ="subtype" ucd="meta.code.class" utype="voprov:ActivityDesc.subtype"  datatype="char" arraysize="*"/>
     <FIELD name="description_link" ucd="meta.ref.url" utype="voprov:ActivityDesc.doculink" datatype="char" arraysize="*"  />  
<DATA>
<TABLEDATA>
<TR><TD>AlaRGB</TD><TD>Aladin RGB image generation algorithm</TD><TD>RGBencoding</TD><TD></TD><TD>http://cds.u-strasbg.fr/aladin.gml</TD></TR>
</TABLEDATA>
</DATA>      
</TABLE>


<TABLE name="entities" utype="prov:Entity" >
       <FIELD name="ident" ucd="meta.id" utype="prov:Entitity.id" datatype = "char" arraysize="*" />
      <FIELD name="label" ucd="meta.title" utype="prov:Entity.label" datatype="char" arraysize="*"  />

      <FIELD name="type" ucd="meta.code.class" utype="prov:Entity.type" datatype="char" arraysize="*" />

       <FIELD name="annotation" ucd="meta.description" utype="voprov:Entity.annotation" datatype="char" arraysize="*" />

       <FIELD name="acref" ucd="meta.ref.url" utype="voprov:Entity.access_reference" datatype="char" arraysize="*" />
       <FIELD name="description link" ucd="meta.ref.url"  utype="voprov:Entity.doculink" datatype="char"   />

       <FIELD name="dataproduct type" ucd="meta.code.class"  utype="voprov:Entity.data_productype" datatype="char" arraysize="*"  />
       <FIELD name="level" ucd="meta.code" utype="voprov:Entity.level" datatype="int"   />  
 
<DATA>
<TABLEDATA>
<TR><TD>ivo://CDS/P/DSS2color#RGB_NGC6946</TD><TD>RGB DSS2 image for NGC 6946</TD><TD></TD><TD>This is a PNG RGB image built from DSS2 with Aladin for galaxy NGC 6946</TD><TD>file://home/bonnarel/Aladin/RGB/RGB_NGC6946.png</TD><TD>http://cds.u-strasbg.fr/aladin.gml</TD><TD>image</TD><TD>3</TD></TR>
<TR><TD>ivo://CDS/P/DSS2/POSSII#POSSII.J-DSS2.143</TD><TD>POSSII Blue Survey DSS2 NGC6946</TD><TD></TD><TD>This is the DSS2 digitazition of the Blue POSSII Schmidt survey around NGC 6946</TD><TD>file://home/bonnarel/Aladin/RGB/POSSII.J-DSS2.143.fits</TD><TD>http://cds.u-strasbg.fr/aladin.gml</TD><TD>image</TD><TD>2</TD></TR>
<TR><TD>ivo://CDS/P/DSS2/POSSII#POSSII.F-DSS2.143</TD><TD>POSSII Red Survey DSS2 NGC6946</TD><TD></TD><TD>This is the DSS2 digitazition of the Red POSSII Schmidt survey around NGC 6946</TD><TD>file://home/bonnarel/Aladin/RGB/POSSII.F-DSS2.143.fits</TD><TD>http://cds.u-strasbg.fr/aladin.gml</TD><TD>image</TD><TD>2</TD></TR>
<TR><TD>ivo://CDS/P/DSS2/POSSII#POSSII.N-DSS2.143</TD><TD>POSSII Infra Red Survey DSS2 NGC6946</TD><TD></TD><TD>This is the DSS2 digitazition of the Infra red POSSII Schmidt survey around  NGC 6946</TD><TD>file://home/bonnarel/Aladin/RGB/POSSII.N-DSS2.143.fits</TD><TD>http://cds.u-strasbg.fr/aladin.gml</TD><TD>image</TD><TD>2</TD></TR>
</TABLEDATA>
</DATA>
</TABLE>

<TABLE name="usedRelationship" utype="voprov:Used" >
      <FIELD name="activity" ucd="meta.id" utype="prov:Activity.id" datatype="char" arraysize="*" />
      <FIELD name="entity" ucd="meta.id" utype="prov:Entity.id" datatype="char" arraysize="*" />
      <FIELD name="role" datatype="char" utype="voprov:Used.role" arraysize="*" />
<DATA>
<TABLEDATA>
<TR><TD>AlaRGB1</TD><TD>ivo://CDS/P/DSS2/POSSII#POSSII.J-DSS2.143</TD><TD>voprov:input</TD></TR>
<TR><TD>AlaRGB1</TD><TD>ivo://CDS/P/DSS2/POSSII#POSSII.F-DSS2.143</TD><TD>voprov:input</TD></TR>
<TR><TD>AlaRGB1</TD><TD>ivo://CDS/P/DSS2/POSSII#POSSII.N-DSS2.143</TD><TD>voprov:input</TD></TR>
</TABLEDATA>
</DATA>
</TABLE>

<TABLE name="WasGeneratedByRelationship" utype="voprov:WasGeneratedBy" >
      <FIELD name="entity" ucd="meta.id" utype="prov:Entity.id" datatype="char" arraysize="*" />
      <FIELD name="activity" ucd="meta.id" utype="prov:Activity.id"  datatype="char" arraysize="*" />
      <FIELD name="role" datatype="char" utype="voprov:WasGeneratedBy.role" arraysize="*" />
<DATA>
<TABLEDATA>
<TR><TD>ivo://CDS/P/DSS2color#RGB_NGC6946</TD><TD>AlaRGB1</TD><TD></TD></TR>
</TABLEDATA>
</DATA>
</TABLE>


</RESOURCE>
</VOTABLE>

\end{verbatim}
  
  
\end{itemize}

Such serializations can be retrieved through Access protocols (see \ref{AccessPro} ) or directly integrated in datasets headers or "associated metadata" in order to provide provenance metadata for these datasets. 


\subsection{Access protocols}
\label{AccessPro}
We envision two possible access protocols:
\begin{itemize}
\item ProvDAL: retrieve provenance information based on given id of a data entity or activity

ProvDAL is a service the interface of which is organized around one main PARAMETER, the ``ID'' of the entity (obs\_publisher\_did of an ObSDataSet for example). The response is given in one of the following formats: PROV-N, PROV-JSON, PROV-XML, PROV-VOTABLE. Additional parameters can complete ID to refine the query. FORMAT allows to choose the output format. STEP allows to discriminate between STEP=LAST which gives the last step in the provenance chain and STEP=ALL which gives the whole chain.
Multiple ID PARAMETER is allowed in order to retrieve several data set provenance details at the same time.
\item ProvTAP: allows detailed queries for provenance information, discovery of datasets based on 
e.g. code version.

ProvTAP is a TAP service implementing the ProvenanceDM data model. The data model mapping is included in the TAP schema. The mapping of ProvenanceDM classes and attributes onto tables and colomns of the schema with the appropriate relationships, datatypes, units, utypes and ucds is done similarly to the PROV-VOTABLE serialization. The query response will result in a single table according to the query.
 This  single table is joining information coming from one or several ``provenance'' tables available in the database. 

A special case is considered where ProvenanceDM and ObsCore are both implemented in the same TAP service and queried together. The TAP response is then providing an Obscore table with a ProvenanceDM extension. We can imagine that in the future this could be hard-coded and registered as an ObsTapProv service. 


\item Do we need combined query possibilities, i.e. ask for ObsCore-fields and Provenance fields
in one query? Or rather use a 2-step-process, decoupling them from each other?
\end{itemize}


%\TODO{Also look at PROV-AQ from the W3C.}
