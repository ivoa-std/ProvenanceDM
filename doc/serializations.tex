\subsection{Introduction, serialization formats}
\label{sec:intro-serialization}
\input{serialisation-intro}

\subsection{Serialization of description classes in the data processing context}
\label{sec:description-serialization}

%{updated by Mathieu} 
%The ProvenanceDM includes description classes that can exist before any provenance information is recorded. 
Description classes in the Provenance DM gather information on the data processing which can preexist to the processing itself.
First, the ActivityDescription class gives generic information on the activity (name, description, doculink...) and the parameters expected as an input. In addition, UsedDescription and WasGeneratedByDescription classes indicate the expected roles of the input and output entities respectively. Finally, The activity may expect specific kinds of entities as inputs or outputs, for which there may be detailed descriptions stored as EntityDescription records.

The serialization of an ActivityDescription, that includes all those description classes, is based on the IVOA DataLink Service Descriptors for service resources \citep{std:Datalink}, and can thus be stored as a VOTable \citep{std:VOTABLE}. Indeed, a service descriptor points to a service that may execute an activity using the given input parameters, some of which probably point to entities. One may thus easily translate an ActivityDescription VOTable to a DataLink service descriptor VOTable block, and vice-versa.

The VOTable contains one resource with attributes type=``meta'' and utype=``voprov:ActivityDescription''. This resource contains PARAM elements to describe the activity and then GROUP elements gathering additional PARAM elements to describe:
\begin{itemize}
 \item the input parameters (group name=``InputParams''),
 \item the input entities (group name=``Used''),
 \item the output entities (group name=``Generated''). 
 \end{itemize}
 
% comment Mireille: 
% what if an activity computes a number , a boolean as a result and produces an output parameter instead of an output entity: e.g compare 2 sets of dataproducts : false/True correlate two datasets : correlation value, etc ...  
% --> add output parameters  ?

The standard PARAM elements for an activity resource correspond to the attributes of the ActivityDescription class (see Section~\ref{sec:activity}) and may include an Agent name and email. Only one agent can be given, corresponding to the main contact for this activity ("contact\_name" and "contact\_email"). 
The "utype" attribute is used to connect the PARAM element to its location in the Provenance DM, so that other optional elements can be added.

For the input parameters, each attribute located in the ParameterDescription class in the model (e.g. units, ucd, utype, \dots) is mapped to an attribute of a PARAM element in the VOTable (both have the same structure, see Section \ref{sec:parameters}).
The "type" attribute of the PARAM element can be set to "no\_query" to indicate that the parameter is optional for the activity (i.e. a default value will be used).

% suggestion Mireille 
% change ``attribute'' to ``element'' to be compliant to the Votable definitions : PARAM, FIELDS are XML elements in the VOtble schema , utype, datatype , etc ... are XML attribute  
% suggestion below 
% ++ The utype attribute in VOTable is used to connect the VOTable element ( PARAM or FIELD) to its location in the Provenance DM.
%++ For the input parameters, each ParameterDescription attribute in the model is mapped to a PARAM element in the VOTable (both have the same structure, see Section \ref{sec:parameters}).

For the input and output entity groups, each entity is described with a GROUP block that contains PARAM elements with e.g. the following names (all attributes describing the entity are optional):
\begin{itemize}
 \item name="default" for the default identifier of the entity (e.g. a file name) or its default value (if the entity is a value),
 \item name="role" that gives the role of the entity with respect to the Used or WasGeneratedBy relation (e.g. "red", "green" or "blue" channel image, or the output "RGB" file),
 \item name="content\_type" for the MIME type expected by the activity for the input or output entity,
 \item other additional PARAM elements corresponding to attributes of EntityDescription, UsedDescription, WasGeneratedByDescription or possibly Agent.
 \end{itemize} 
% mireille suppressed one 'expected'in sentence above
It is possible to reference an input parameter using the \emph{ref} attribute of PARAM, if an input or output entity is referenced as an input parameter to the activity (e.g. the name of an input file). In the following example the output file name "RGB.jpg" is expected as a parameter to the activity and is thus referenced by the id PARAM element located in the GROUP of generated entities (with ref="RGB").

%Here is an example of an ActivityDescription VOTable that describes an activity to create an RGB image from three red, green, blue images:
%++ suggestion mireille : 
Here is an example of an ActivityDescription VOTable that describes an activity to create an RGB image from three input images mapped to the red, green, blue image planes in the composition. 

\begin{verbnobox}[\scriptsize]

<VOTABLE xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns="http://www.ivoa.net/xml/VOTable/v1.3" version="1.3" 
    xsi:schemaLocation="http://www.ivoa.net/xml/VOTable/v1.3 
    http://www.ivoa.net/xml/VOTable/v1.3">
    
  <RESOURCE ID="make_RGB_image" name="make_RGB_image" 
      type="meta" utype="voprov:ActivityDescription">
      
    <DESCRIPTION>Create an RGB image from 3 images</DESCRIPTION>
    <LINK content-role="doc" href="..." />
    <PARAM name="name" datatype="char" arraysize="*" 
        value="make_RGB_image" utype="voprov:ActivityDescription.label" />
    <PARAM name="type" datatype="char" arraysize="*" 
        value="..." utype="voprov:ActivityDescription.type"/>
    <PARAM name="subtype" datatype="char" arraysize="*" 
        value="..." utype="voprov:ActivityDescription.subtype" />
    <PARAM name="version" datatype="float" 
        value="..." utype="voprov:ActivityDescription.version" />
    <PARAM name="contact_name" datatype="char" arraysize="*" 
        value="..." utype="voprov:Agent.name" />
    <PARAM name="contact_email" datatype="char" arraysize="*" 
        value="...@..." utype="voprov:Agent.email" />
        
    <GROUP name="InputParams" utype="voprov:ParameterDescription">
      <PARAM ID="RGB" arraysize="*" datatype="char" name="RGB" 
          type="no_query" value="RGB.jpg">
        <DESCRIPTION>RGB image name</DESCRIPTION>
      </PARAM>
    </GROUP>
		
    <GROUP name="Used" utype="voprov:UsedDescription">
      <GROUP name="R" utype="voprov:EntityDescription">
        <DESCRIPTION>Image for red channel</DESCRIPTION>
        <PARAM name="default" value="R.jpg" arraysize="*" datatype="char" utype="voprov:Entity.id" />
        <PARAM name="role" value="red" arraysize="*" datatype="char" 
            utype="voprov:UsedDescription.role" />
        <PARAM name="content_type" value="image/jpeg" arraysize="*" datatype="char" 
            utype="voprov:EntityDescription.content_type" />
      </GROUP>
      <GROUP name="G" utype="voprov:EntityDescription">
        <DESCRIPTION>Image for green channel</DESCRIPTION>
        <PARAM name="default" value="G.jpg" arraysize="*" datatype="char" utype="voprov:Entity.id" />
        <PARAM name="role" value="green" arraysize="*" datatype="char" 
            utype="voprov:UsedDescription.role" />
        <PARAM name="content_type" value="image/jpeg" arraysize="*" datatype="char" 
           utype="voprov:EntityDescription.content_type" />
      </GROUP>
      <GROUP name="B" utype="voprov:EntityDescription">
        <DESCRIPTION>Image for blue channel</DESCRIPTION>
        <PARAM name="default" value="B.jpg" arraysize="*" datatype="char" utype="voprov:Entity.id" />
        <PARAM name="role" value="blue" arraysize="*" datatype="char" 
            utype="voprov:UsedDescription.role" />
        <PARAM name="content_type" value="image/jpeg" arraysize="*" datatype="char" 
            utype="voprov:EntityDescription.content_type" />
      </GROUP>
    </GROUP>
    
    <GROUP name="Generated" utype="voprov:WasGeneratedByDescription">
      <GROUP name="RGB" utype="voprov:EntityDescription">
        <DESCRIPTION>RGB image generated</DESCRIPTION>
        <PARAM name="role" value="RGB" arraysize="*" datatype="char" 
            utype="voprov:WasGenereratedByDescription.role" />
        <PARAM name="content_type" value="image/jpeg" arraysize="*" datatype="char" 
            utype="voprov:EntityDescription.content_type" />
      </GROUP>
      </PARAM>
    </GROUP>
    
  </RESOURCE>
</VOTABLE>

\end{verbnobox}

\input{serialization-w3c}